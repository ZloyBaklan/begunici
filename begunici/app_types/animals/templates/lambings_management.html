{% extends 'base.html' %}
{% load static %}
{% block title %}Управление окотами{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>Управление окотами</h1>

    <div class="row">
        <!-- Левая колонка - Завод окотов -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5>Завод окотов</h5>
                </div>
                <div class="card-body">
                    <form id="create-lambing-form">
                        <div class="mb-3">
                            <label for="lambing-start-date" class="form-label">Дата начала окота</label>
                            <input type="date" class="form-control" id="lambing-start-date" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Выбор ярок/овец</label>
                            <button type="button" class="btn btn-outline-primary w-100" onclick="showSelectMothersModal()">
                                Выбрать ярок/овец
                            </button>
                            <div id="selected-mothers-display" class="mt-2 text-muted">
                                Не выбрано
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Выбор производителя/барана</label>
                            <button type="button" class="btn btn-outline-primary w-100" onclick="showSelectFatherModal()">
                                Выбрать производителя/барана
                            </button>
                            <div id="selected-father-display" class="mt-2 text-muted">
                                Не выбран
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="lambing-note" class="form-label">Примечание (необязательно)</label>
                            <textarea class="form-control" id="lambing-note" rows="3"></textarea>
                        </div>
                        
                        <button type="button" class="btn btn-success w-100" onclick="createMultipleLambings()">
                            Завести окот
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Правая колонка - Таблица активных окотов -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5>Активные окоты</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead class="table-light">
                                <tr>
                                    <th>Мать</th>
                                    <th>Отец</th>
                                    <th>Начало окота</th>
                                    <th>Конец окота</th>
                                    <th>Примечание</th>
                                    <th>Действия</th>
                                </tr>
                            </thead>
                            <tbody id="active-lambings-table">
                                <tr>
                                    <td colspan="6" class="text-center text-muted">Загрузка...</td>
                                </tr>
                                <!-- Данные будут загружены через JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Пагинация -->
                    <div id="pagination" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно выбора овец/ярок -->
<div class="modal fade" id="selectMothersModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Выбор ярок/овец</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="mothers-list" style="max-height: 400px; overflow-y: auto;">
                    <!-- Список будет загружен через JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                <button type="button" class="btn btn-primary" onclick="confirmMothersSelection()">Выбрать</button>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно выбора отца -->
<div class="modal fade" id="selectFatherModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Выбор производителя/барана</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="fathers-list" style="max-height: 400px; overflow-y: auto;">
                    <!-- Список будет загружен через JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                <button type="button" class="btn btn-primary" onclick="confirmFatherSelection()">Выбрать</button>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно завершения окота -->
<div class="modal fade" id="completeLambingModal" tabindex="-1" aria-labelledby="completeLambingModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="completeLambingModalLabel">Завершение окота</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="lambing-completion-form">
                    <h6>Информация об окоте</h6>
                    <div class="mb-3">
                        <label class="form-label">Дата фактических родов:</label>
                        <input type="date" id="actual-lambing-date" class="form-control" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Количество родившихся ягнят:</label>
                        <input type="number" id="lambs-count" class="form-control" min="0" max="10" value="1">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Примечание к окоту:</label>
                        <textarea id="lambing-note" class="form-control" rows="2"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Новый статус для матери:</label>
                        <select id="new-mother-status" class="form-control" required>
                            <option value="">Выберите статус...</option>
                            <!-- Статусы будут загружены через JavaScript -->
                        </select>
                    </div>
                    
                    <hr>
                    
                    <div id="lambs-creation-section">
                        <h6>Создание ягнят</h6>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="create-lambs-checkbox" checked>
                            <label class="form-check-label" for="create-lambs-checkbox">
                                Создать записи о ягнятах
                            </label>
                        </div>
                        
                        <div id="lambs-forms-container">
                            <!-- Формы для создания ягнят будут добавлены через JavaScript -->
                        </div>
                    </div>
                </div>
                
                <!-- Скрытое поле для ID окота -->
                <input type="hidden" id="completing-lambing-id">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                <button type="button" class="btn btn-success" onclick="completeLambingWithChildren()">Завершить окот</button>
            </div>
        </div>
    </div>
</div>

<style>
.lamb-form {
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    background-color: #f8f9fa;
}

.lamb-form h6 {
    color: #495057;
    margin-bottom: 10px;
}

.form-row {
    display: flex;
    gap: 15px;
    margin-bottom: 10px;
}

.form-row .form-group {
    flex: 1;
}

.form-group label {
    font-weight: 500;
    margin-bottom: 5px;
    display: block;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #ced4da;
    border-radius: 4px;
    font-size: 14px;
}

.remove-lamb-btn {
    background-color: #dc3545;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
}

.remove-lamb-btn:hover {
    background-color: #c82333;
}
</style>

<script type="module" src="{% static 'js/lambings_management.js' %}"></script>
{% endblock %}